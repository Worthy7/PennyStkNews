<!DOCTYPE html>


<html>
	<body>
		<div ng-app="myShoppingList" ng-controller="postsController">
			<ul>
			        <li ng-repeat="post in posts">
				        {{post.gid}} <br> 
				        {{post.pubDate}} <br> 
				        {{post.title}} <br> 
				        {{post.price}} <br> 
			        	<div tvgraph="{{post.ticker}}" id="tv-medium-widget-{{post.ticker}}"></div>
			        </li>
			</ul>
		</div>
	</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
<script type="text/javascript" src="moment-with-locales.min.js"></script>
<script type="text/javascript" src="moment-timezone-with-data.min.js"></script>
<script type="text/javascript" src="storage.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="site.js"></script>
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<script>
	var app = angular.module("myShoppingList", []); 
	app.controller("postsController", function($scope) {
		this.posts = stg.getPosts().slice(0,2)
		postsvms = []
		for (var i = 0; i < this.posts.length; i++){
				post = this.posts[i]

				postsvms.push({
						gid : parseId(post),
						pubDate : parsePubDate(post),
						title : parseTag(post, "title"),
						price : parseTag(post, "price"),
						ticker : parseTicker(post)
				})
		}

	    $scope.posts = postsvms

	});


// Directive
  app.directive('tvgraph', function () {
    return {
      	link: function ($scope, element, attrs, ctrl) {
        	var watch = $scope.$watch(function() {
                return element.children().length;
            }, function() {
	                // Wait for templates to render
	                $scope.$evalAsync(function() {
	                    // Finally, directives are evaluated
	                    // and templates are renderer here
	                    var children = element.children();
                    	console.log(children);

			        	new TradingView.MediumWidget({
							  "container_id": "tv-medium-widget-"+ attrs.tvgraph,
							  "symbols": [
							    attrs.tvgraph+"|1d"
							  ],
							  "gridLineColor": "#e9e9ea",
							  "fontColor": "#83888D",
							  "underLineColor": "#dbeffb",
							  "trendLineColor": "#4bafe9",
							  "width": "500px",
							  "height": "300px",
							  "locale": "en",
							  "chartOnly": false
						});
        			})
            	}
            )
        }
    }
  });

</script>

